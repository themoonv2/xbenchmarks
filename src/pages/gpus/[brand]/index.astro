---
import Layout from "../../../layouts/Layout.astro";
import gpus from "../../../data/gpus.json";
import { getBrand, getSeries, slugify } from "../../../utils/data-helpers";

export async function getStaticPaths() {
    const brands = [...new Set(gpus.map((c) => getBrand(c.name)))];
    return brands.map((brand) => ({
        params: { brand: slugify(brand) },
        props: { brandName: brand },
    }));
}

const { brand } = Astro.params;
const { brandName } = Astro.props;

// Filter and get unique series
const brandGpus = gpus.filter((c) => slugify(getBrand(c.name)) === brand);
const seriesMap = new Map();

brandGpus.forEach((gpu) => {
    const s = getSeries(gpu.name);
    const slug = slugify(s);
    if (!seriesMap.has(slug)) {
        seriesMap.set(slug, s);
    }
});

const seriesList = Array.from(seriesMap.values()).sort();
---

<Layout title={`${brandName} GPUs - Series List`}>
    <h1>{brandName} Graphics</h1>
    <p>Select a series to view available models.</p>

    <div
        class="grid"
        style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); margin-top: var(--space-6);"
    >
        {
            seriesList.map((series) => (
                <a
                    href={`${import.meta.env.BASE_URL}/gpus/${brand}/${slugify(series)}`}
                    class="series-card"
                >
                    <span class="series-name">{series} Series</span>
                </a>
            ))
        }
    </div>
</Layout>

<style>
    .series-card {
        border: var(--border-primary);
        padding: var(--space-4);
        text-decoration: none;
        color: var(--color-text);
        font-weight: 600;
        font-size: var(--text-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        transition: background 0.2s;
    }

    .series-card:hover {
        background-color: var(--color-surface);
    }
</style>
