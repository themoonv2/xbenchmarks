---
import Layout from "../../../../layouts/Layout.astro";
import gpus from "../../../../data/gpus.json";
import { getBrand, getSeries, slugify } from "../../../../utils/data-helpers";

export async function getStaticPaths() {
    const paths = [];
    const brands = [...new Set(gpus.map((c) => getBrand(c.name)))];

    brands.forEach((brand) => {
        const brandSlug = slugify(brand);
        const brandGpus = gpus.filter((c) => getBrand(c.name) === brand);
        const seriesList = [
            ...new Set(brandGpus.map((c) => getSeries(c.name))),
        ];

        seriesList.forEach((series) => {
            paths.push({
                params: {
                    brand: brandSlug,
                    series: slugify(series),
                },
                props: {
                    brandName: brand,
                    seriesName: series,
                    gpus: brandGpus.filter((c) => getSeries(c.name) === series),
                },
            });
        });
    });

    return paths;
}

const { brandName, seriesName, gpus: seriesGpus } = Astro.props;
const { brand, series } = Astro.params;
---

<Layout title={`${brandName} ${seriesName} Graphics Cards`}>
    <h1>{brandName} {seriesName} Series</h1>
    <p>Available models in this series.</p>

    <div class="list-container">
        {
            seriesGpus.map((gpu) => {
                const modelSlug = gpu.slug || slugify(gpu.name);
                return (
                    <div class="item-row">
                        <div class="item-info">
                            <h3>
                                <a
                                    href={`${import.meta.env.BASE_URL}/gpus/${brand}/${series}/${modelSlug}`}
                                >
                                    {gpu.name}
                                </a>
                            </h3>
                            <div class="specs-preview">
                                <span>
                                    Score:{" "}
                                    {gpu.scores
                                        ? gpu.scores["NanoReview Final Score"]
                                        : "N/A"}
                                </span>
                                {gpu.specs["Memory Size"] && (
                                    <span>
                                        VRAM: {gpu.specs["Memory Size"]}
                                    </span>
                                )}
                            </div>
                        </div>
                        <div class="item-action">
                            {gpu.price && (
                                <span class="price">${gpu.price}</span>
                            )}
                            <a
                                href={`${import.meta.env.BASE_URL}/gpus/${brand}/${series}/${modelSlug}`}
                                class="btn"
                            >
                                View Specs
                            </a>
                        </div>
                    </div>
                );
            })
        }
    </div>
</Layout>

<style>
    .list-container {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
        margin-top: var(--space-6);
    }

    .item-row {
        border: var(--border-primary);
        padding: var(--space-4);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    @media (max-width: 600px) {
        .item-row {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-4);
        }
        .item-action {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
    }

    .item-info h3 {
        font-size: var(--text-lg);
        margin-bottom: var(--space-2);
    }

    .item-info h3 a {
        text-decoration: none;
        color: var(--color-text);
    }

    .specs-preview {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        display: flex;
        gap: var(--space-4);
    }

    .item-action {
        display: flex;
        align-items: center;
        gap: var(--space-4);
    }

    .price {
        font-weight: 700;
    }
</style>
