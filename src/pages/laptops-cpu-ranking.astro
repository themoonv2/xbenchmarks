---
import Layout from "../layouts/Layout.astro";
import cpus from "../data/cpus.json";
import { getBrand, getSeries, slugify, getImageUrl } from "../utils/data-helpers";

// Filter for Laptop CPUs
const laptopCpus = cpus
    .filter((cpu) => cpu.specs.Type === "Laptop")
    .sort((a, b) => {
        const scoreA = parseInt(a.scores["NanoReview Final Score"] || "0");
        const scoreB = parseInt(b.scores["NanoReview Final Score"] || "0");
        return scoreB - scoreA;
    });

function formatScore(score) {
    return score ? score : "-";
}
---

<Layout title="Laptop Processors Ranking | XBenchmarks">
    <section class="section">
        <h1 class="page-title">Laptop Processors Ranking</h1>
        <p class="section-desc">
            Benchmark list of mobile processors (CPUs) for laptops, ranked by
            performance, energy efficiency, and benchmarks.
        </p>

        <div class="table-container">
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th class="rank-col">#</th>
                        <th class="thumb-col"></th>
                        <th class="model-col">CPU</th>
                        <th class="score-col">Rating</th>
                        <th>iGPU</th>
                        <th>Energy</th>
                        <th>Cinebench R23<br />Single</th>
                        <th>Cinebench R23<br />Multi</th>
                        <th>Cores</th>
                        <th>TDP</th>
                        <th>L3 Cache</th>
                    </tr>
                </thead>
                <tbody>
                    {
                        laptopCpus.map((cpu, index) => {
                            const brand = getBrand(cpu.name);
                            const series = getSeries(cpu.name);
                            const modelSlug = cpu.slug || slugify(cpu.name);
                            const link = `${import.meta.env.BASE_URL}/cpus/${slugify(brand)}/${slugify(series)}/${modelSlug}`;
                            const score =
                                cpu.scores["NanoReview Final Score"] || "-";
                            const igpu = formatScore(
                                cpu.scores["Integrated Graphics"],
                            );
                            const energy = formatScore(
                                cpu.scores["Power Efficiency"],
                            );
                            const r23s = formatScore(
                                cpu.scores["Cinebench R23 (Single-Core)"],
                            );
                            const r23m = formatScore(
                                cpu.scores["Cinebench R23 (Multi-Core)"],
                            );
                            const cores = cpu.specs["Total Cores"] || "-";
                            const pCores =
                                cpu.specs["P-Cores"] &&
                                cpu.specs["P-Cores"] !== "-"
                                    ? `${cpu.specs["P-Cores"]}P`
                                    : "";
                            const eCores =
                                cpu.specs["E-Cores"] &&
                                cpu.specs["E-Cores"] !== "-"
                                    ? `${cpu.specs["E-Cores"]}E`
                                    : "";
                            const coreDetail = [pCores, eCores]
                                .filter(Boolean)
                                .join(" + ");
                            const tdp = cpu.specs["TDP (PL1)"] || "-";
                            const cache = cpu.specs["L3 Cache"] || "-";

                            return (
                                <tr>
                                    <td class="rank-col">{index + 1}</td>
                                    <td class="thumb-col">
                                        {cpu.images?.main && (
                                            <img
                                                src={getImageUrl(cpu.images.main, import.meta.env.BASE_URL)}
                                                alt={cpu.name}
                                                class="thumbnail"
                                            />
                                        )}
                                    </td>
                                    <td class="model-col">
                                        <a href={link} class="table-link">
                                            {cpu.name}
                                        </a>
                                        <div class="brand-tag">
                                            {brand} (
                                            {cpu.specs["Fabrication Process"] ||
                                                "-"}
                                            )
                                        </div>
                                    </td>
                                    <td class="score-col">
                                        <div class="score-badge">{score}</div>
                                    </td>
                                    <td>{igpu}</td>
                                    <td>{energy}</td>
                                    <td>{r23s}</td>
                                    <td>{r23m}</td>
                                    <td>
                                        <div class="core-val">{cores}</div>
                                        {coreDetail && (
                                            <div class="core-detail">
                                                ({coreDetail})
                                            </div>
                                        )}
                                    </td>
                                    <td>{tdp}</td>
                                    <td>{cache}</td>
                                </tr>
                            );
                        })
                    }
                </tbody>
            </table>
        </div>
    </section>
</Layout>

<style>
    .page-title {
        margin-bottom: var(--space-2);
    }
    .section-desc {
        color: var(--color-text-muted);
        margin-bottom: var(--space-6);
        max-width: 60ch;
    }
    .table-container {
        overflow-x: auto;
    }
    .ranking-table {
        width: 100%;
        min-width: 1000px; /* Ensure table doesn't squash on small screens */
        border-collapse: collapse;
        font-size: var(--text-sm);
    }
    .ranking-table th,
    .ranking-table td {
        padding: var(--space-2) var(--space-3);
        text-align: left;
        border-bottom: 1px solid #e5e5e5;
        vertical-align: middle;
    }
    .ranking-table th {
        font-weight: 600;
        color: var(--color-text-muted);
        font-size: var(--text-xs);
        white-space: nowrap;
    }
    .rank-col {
        width: 40px;
        text-align: center !important;
        color: var(--color-text-muted);
    }
    .thumb-col {
        width: 60px;
        text-align: center !important;
        padding: var(--space-2) !important;
    }
    .thumbnail {
        width: 48px;
        height: 48px;
        object-fit: contain;
        border-radius: 4px;
        background-color: var(--color-surface);
        padding: 2px;
    }
    .score-col {
        width: 80px;
        text-align: center !important;
    }
    .table-link {
        display: block;
        font-weight: 600;
        text-decoration: none;
        color: var(--color-text);
        margin-bottom: 2px;
    }
    .table-link:hover {
        text-decoration: underline;
    }
    .score-badge {
        display: inline-block;
        padding: 4px 10px;
        background-color: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 99px;
        font-weight: 700;
        min-width: 40px;
        text-align: center;
    }
    .brand-tag {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
    }
    .core-val {
        font-weight: 600;
    }
    .core-detail {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
        white-space: nowrap;
    }
</style>
