---
import Layout from '../../../layouts/Layout.astro';
import { getLaptopComparisons, extractNumericValue } from '../../../utils/comparison-utils';

export async function getStaticPaths() {
	const comparisons = getLaptopComparisons();
	return comparisons.map(comp => ({
		params: { comparison: comp.id },
		props: { comp }
	}));
}

const { comparison } = Astro.params;
const { comp } = Astro.props;

if (!comp) {
	return Astro.redirect('/compare/laptop');
}

const laptop1 = comp.model1;
const laptop2 = comp.model2;

// Create unique description
const description = `Compare ${laptop1.name} vs ${laptop2.name} laptop specs, performance, price, and features. Detailed side-by-side comparison to help choose the best laptop.`;

// Build the H1 title with screen size if available
let h1Title = `${laptop1.name} vs ${laptop2.name}`;
const display1 = laptop1.specs?.Display || '';
const display2 = laptop2.specs?.Display || '';
const screenSize1 = display1.match(/(\d+\.?\d*)"/)?.[1] || '';
const screenSize2 = display2.match(/(\d+\.?\d*)"/)?.[1] || '';

if (screenSize1 && screenSize2) {
	if (screenSize1 === screenSize2) {
		h1Title = `${laptop1.name} vs ${laptop2.name} (${screenSize1}″)`;
	} else {
		h1Title = `${laptop1.name} (${screenSize1}″) vs ${laptop2.name} (${screenSize2}″)`;
	}
} else if (screenSize1 || screenSize2) {
	if (screenSize1) h1Title = `${laptop1.name} (${screenSize1}″) vs ${laptop2.name}`;
	else h1Title = `${laptop1.name} vs ${laptop2.name} (${screenSize2}″)`;
}

// Get all score keys from both laptops
const allScoreKeys = new Set([
	...Object.keys(laptop1.scores || {}),
	...Object.keys(laptop2.scores || {})
]);
---


<Layout title={`${laptop1.name} vs ${laptop2.name} - Laptop Comparison`} description={description}>
	<div class="comparison-container">
		<div class="page-header">
			<h1 class="page-title">{h1Title}</h1>
		</div>

		<!-- Card with Score Bars -->
		<div class="card">
			<div class="two-columns">
				{Array.from(allScoreKeys).sort().map(categoryKey => {
					const score1 = laptop1.scores?.[categoryKey];
					const score2 = laptop2.scores?.[categoryKey];
					const num1 = extractNumericValue(score1);
					const num2 = extractNumericValue(score2);
					const categoryWinner = num1 && num2 ? (num1 > num2 ? 1 : num2 > num1 ? 2 : 0) : 0;
					
					const maxVal = Math.max(num1 || 0, num2 || 0);
					const width1 = maxVal > 0 ? Math.min(100, (num1 / maxVal) * 100) : 0;
					const width2 = maxVal > 0 ? Math.min(100, (num2 / maxVal) * 100) : 0;
					
					return (
						<div class="two-columns-item mb">
							<div class="score-bar">
								<span class={`score-bar-name`}>{categoryKey}</span>
								<span class={`score-bar-result-square ${categoryWinner === 1 ? 'score-bar-result-square-dark' : ''}`}>
									{num1 ? Math.round(num1) : 'N/A'}
								</span>
								<div class="score-bar-line">
									<div class="score-bar-line-filled" style={`width: ${width1}%`}></div>
								</div>
							</div>
						</div>
					);
				})}
				{Array.from(allScoreKeys).sort().map(categoryKey => {
					const score1 = laptop1.scores?.[categoryKey];
					const score2 = laptop2.scores?.[categoryKey];
					const num1 = extractNumericValue(score1);
					const num2 = extractNumericValue(score2);
					const categoryWinner = num1 && num2 ? (num1 > num2 ? 1 : num2 > num1 ? 2 : 0) : 0;
					
					const maxVal = Math.max(num1 || 0, num2 || 0);
					const width2 = maxVal > 0 ? Math.min(100, (num2 / maxVal) * 100) : 0;
					
					return (
						<div class="two-columns-item mb">
							<div class="score-bar">
								<span class={`score-bar-name`}>{categoryKey}</span>
								<span class={`score-bar-result-square ${categoryWinner === 2 ? 'score-bar-result-square-dark' : ''}`}>
									{num2 ? Math.round(num2) : 'N/A'}
								</span>
								<div class="score-bar-line">
									<div class="score-bar-line-filled" style={`width: ${width2}%`}></div>
								</div>
							</div>
						</div>
					);
				})}
			</div>
		</div>
	</div>
</Layout>

<style>
	.comparison-container {
		max-width: 1200px;
		margin: 0 auto;
		padding: 2rem;
	}

	.page-header {
		margin-bottom: 2rem;
	}

	.page-title {
		font-size: 2rem;
		font-weight: 700;
		margin: 0;
		color: #1a1a1a;
	}

	.card {
		background: white;
		border: 1px solid #e6e6e8;
		border-radius: 8px;
		padding: 2rem;
	}

	.two-columns {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		column-gap: 16px;
	}

	.two-columns-item {
		display: flex;
		flex-direction: column;
	}

	.two-columns-item.mb {
		margin-bottom: 1rem;
	}

	.score-bar {
		display: flex;
		align-items: center;
		gap: 12px;
		background: #fafafa;
		padding: 12px;
		border-radius: 6px;
	}

	.score-bar-name {
		flex: 0 0 auto;
		font-weight: 500;
		font-size: 0.9rem;
		color: #646464;
		width: 80px;
	}

	.score-bar-result-square {
		flex: 0 0 auto;
		background: white;
		border: 1px solid #e6e6e8;
		padding: 8px 12px;
		border-radius: 4px;
		font-weight: 600;
		font-size: 0.9rem;
		color: #1a1a1a;
		min-width: 50px;
		text-align: center;
	}

	.score-bar-result-square-dark {
		background: #3949ab;
		color: white;
		border-color: #3949ab;
	}

	.score-bar-line {
		flex: 1;
		height: 4px;
		background: #e6e6e8;
		border-radius: 2px;
		overflow: hidden;
	}

	.score-bar-line-filled {
		height: 100%;
		background: #3949ab;
		border-radius: 2px;
		transition: width 0.3s ease;
	}

	@media only screen and (max-width: 580px) {
		.comparison-container {
			padding: 1rem;
		}

		.page-title {
			font-size: 1.5rem;
		}

		.two-columns {
			grid-template-columns: 1fr;
		}

		.score-bar-name {
			width: auto;
		}
	}
</style>
